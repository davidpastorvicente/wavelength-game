<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wavelength Game</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'orbitron': ['Orbitron', 'sans-serif'],
                        'roboto': ['Roboto', 'sans-serif']
                    },
                    colors: {
                        'primary': '#3b82f6',
                        'secondary': '#38a169'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: "Roboto", sans-serif;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .button {
            color: white;
            font-size: 1.125rem;
            line-height: 1.75rem;
            padding: .5rem 1rem;
            border-radius: 0.5rem;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        .board {
            aspect-ratio: 2 / 1;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .target-area {
            border-radius: 200px 200px 0 0;
            position: absolute;
            overflow: hidden;
        }

        .needle-container {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            cursor: pointer;
        }

        .needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transition: transform 0.2s ease;
        }

        .bidirectional-arrow {
            position: relative;
            flex-shrink: 0;
        }

        .bidirectional-arrow::before,
        .bidirectional-arrow::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 10px;
            height: 10px;
            border-top: 2px solid #3b82f6;
            border-right: 2px solid #3b82f6;
        }

        .bidirectional-arrow::before {
            left: 0;
            transform: translateY(-50%) rotate(-135deg);
        }

        .bidirectional-arrow::after {
            right: 0;
            transform: translateY(-50%) rotate(45deg);
        }

        .modal {
            display: none;
            backdrop-filter: blur(5px);
        }

        .modal.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-content {
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease-out;
        }

        #score {
            position: absolute;
            top: 30%;
            left: 50%;
            padding: .5rem 1rem;
            transform: translateX(-50%);
            background-color: white;
        }

        .score-5 {
            color: #adc8da;
            font-weight: bold;
        }

        .score-3 {
            color: #ee7648;
            font-weight: bold;
        }

        .score-1 {
            color: #fec942;
            font-weight: bold;
        }

        .score-0 {
            color: #eeefe8;
            font-weight: bold;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            /* display: none; <- Crashes Chrome on hover */
            -webkit-appearance: none;
            margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
        }
    </style>
</head>

<body class="flex justify-center items-center h-screen">
    <!-- How to Play Modal -->
    <div id="howToPlayModal" class="modal fixed z-50 left-0 top-0 w-full h-full overflow-auto bg-gray-900 bg-opacity-50">
        <div class="modal-content bg-white mx-auto my-10 p-8 rounded-xl shadow-xl max-w-2xl w-11/12 text-center">
            <h2 class="text-secondary text-2xl md:text-3xl font-bold mb-5 text-center">Instrucciones</h2>
            <div class="modal-body text-dark text-base md:text-lg leading-relaxed mb-5 text-left">
                <ol class="list-decimal pl-5 space-y-3">
                    <li>Se mostrará un par de conceptos opuestos.</li>
                    <li>El Psíquico da una pista sobre dónde está ubicado el objetivo EN EL ESPECTRO entre los dos conceptos
                        <ul class="list-disc pl-5 mt-2">
                            <li>Por ejemplo, entre CALIENTE y FRÍO</li>
                            <li>El Psíquico puede decir algo como ¡CAFÉ!</li>
                        </ul>
                    </li>
                    <li>Ahora depende del psíquico discutir la pista y decidir hacia dónde mover la aguja.</li>
                    <li>Haz clic y arrastra la aguja para establecer tu respuesta.</li>
                    <li>Haz clic en "Ocultar" para confirmar tu respuesta.</li>
                    <li>Haz clic en "Confirmar" para ver qué tan cerca estuviste.</li>
                    <li>Puntuación:
                        <ul class="list-disc pl-5 mt-2">
                            <li><span class="score-5">5 puntos:</span> En el centro exacto (azul oscuro)</li>
                            <li><span class="score-3">3 puntos:</span> Cerca (amarillo)</li>
                            <li><span class="score-1">1 punto:</span> Próximo (rojo)</li>
                            <li><span class="score-0">0 puntos:</span> Fallo</li>
                        </ul>
                    </li>
                    <li>Haz clic en "Siguiente" para continuar o en "Omitir" para nuevos conceptos.</li>
                </ol>
            </div>
            <button id="close" class="button bg-primary hover:bg-blue-700">Got it!</button>
        </div>
    </div>

    <!-- Player Setup -->
    <div id="playerSetup" class="bg-white p-8 rounded-xl shadow-lg max-w-2xl w-full m-4 text-center">
        <h1 class="title font-orbitron text-5xl md:text-6xl font-bold text-primary mb-4">Wavelength</h1>
        <h2 class="text-2xl font-bold text-dark mb-6">Configuración</h2>
        <div class="player-count mb-3">
            <label for="playerCount" class="block text-lg mb-2">Número de equipos:</label>
            <input type="number" id="playerCount" min="2" max="5" value="2" class="border rounded p-2 text-center w-12">
        </div>
        <div id="playerNames" class="mb-6">
        </div>
        <div class="controls flex justify-center gap-3 mt-6 flex-wrap">
            <button id="initGame" class="button bg-primary hover:bg-blue-700">Nuevo juego</button>
            <button id="howToPlay" class="button bg-secondary hover:bg-green-700">Cómo jugar</button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer" class="bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl m-4 text-center hidden">
        <h1 class="title font-orbitron text-4xl md:text-5xl font-bold text-primary mb-5">Wavelength</h1>

        <!-- Game Board -->
        <div class="board mx-auto rounded-t-full">
            <div class="target-area w-full h-full" id="targetArea"></div>
            <div class="needle-container w-full h-full" id="needleContainer">
                <div class="needle w-1 h-5/6 bg-red-500 -translate-x-1/2 hidden" id="needle"></div>
            </div>
        </div>

        <!-- Clues -->
        <div class="clues-container flex items-center justify-center mt-4">
            <div class="clue md:text-lg font-medium text-dark px-3 flex-1 text-center" id="leftClue"></div>
            <div class="bidirectional-arrow w-16 md:w-40 h-0.5 bg-primary mx-4"></div>
            <div class="clue md:text-lg font-medium text-dark px-3 flex-1 text-center" id="rightClue"></div>
        </div>

        <!-- Controls -->
        <div class="controls flex justify-center gap-3 mt-6 flex-wrap">
            <button id="toggle" class="button bg-primary hover:bg-blue-700"></button>
            <button id="nextRound" class="button bg-gray-400 hover:bg-gray-600"></button>
            <button id="newGame" class="hidden button bg-red-500 hover:bg-red-700">Resetear</button>
        </div>

        <!-- Score Display -->
        <div id="totalScore" class="mt-5 flex items-center justify-evenly flex-col sm:flex-row text-lg">
            <div></div>
            <div class="current-player font-bold text-secondary"></div>
        </div>
        <div id="score" class="hidden rounded shadow mt-3">Hola</div>
    </div>

    <script>
        // Game elements
        const needleContainer = document.getElementById("needleContainer");
        const needle = document.getElementById("needle");
        const targetArea = document.getElementById("targetArea");
        const toggleButton = document.getElementById("toggle");
        const nextRoundButton = document.getElementById("nextRound");
        const newGameButton = document.getElementById("newGame");
        const scoreElement = document.getElementById("score");
        const totalScoreElement = document.getElementById("totalScore");

        // Player setup elements
        const playerSetup = document.getElementById('playerSetup');
        const playerCount = document.getElementById('playerCount');
        const playerNames = document.getElementById('playerNames');
        const initGameButton = document.getElementById('initGame');
        const howToPlayButton = document.getElementById("howToPlay");
        const howToPlayModal = document.getElementById("howToPlayModal");
        const closeButton = document.getElementById("close");
        const gameContainer = document.getElementById('gameContainer');

        // Game state
        let players = [];
        let targetAngle = 0;
        let currentPlayerIndex = 0;
        let isDragging = false;
        let isTargetVisible = true;
        let canMoveNeedle = false;


        // Clues data
        const clues = [
            ["Mala compañía", "Buena compañía"],
            ["Película terrible", "Película excelente"],
            ["Persona olvidable", "Persona memorable"],
            ["Culturalmente insignificante", "Culturalmente significativa"],
            ["Comida seca", "Comida húmeda"],
            ["Fácil de hacer", "Difícil de hacer"],
            ["Se siente mal", "Se siente bien"],
            ["Sin pelo", "Peludo"],
            ["Difícil de recordar", "Fácil de recordar"],
            ["Frío", "Caliente"],
            ["Inflexible", "Flexible"],
            ["Comida limpia", "Comida desordenada"],
            ["Comida con utensilios", "Comida con las manos"],
            ["Querer", "Necesitar"],
            ["Objeto extraño de poseer", "Objeto normal de poseer"],
            ["Mal hecho", "Bien hecho"],
            ["Lugar tranquilo", "Lugar ruidoso"],
            ["Común", "Raro"],
            ["Influencia negativa", "Modelo a seguir"],
            ["Animal puntiagudo", "Animal redondeado"],
            ["Duro", "Blando"],
            ["Feo", "Hermoso"],
            ["Trabajo mal pagado", "Trabajo bien pagado"],
            ["Habilidad subestimada", "Habilidad sobrevalorada"],
            ["Emoji poco sexy", "Emoji sexy"],
            ["Inútil", "Útil"],
            ["Villano", "Héroe"],
            ["Peor día", "Mejor día"],
            ["Pasatiempo aburrido", "Pasatiempo emocionante"],
            ["Súperpoder inútil", "Súperpoder increíble"],
            ["Truco de fiesta malo", "Truco de fiesta genial"],
            ["Primer cita terrible", "Primer cita perfecta"],
            ["Tema de conversación incómodo", "Tema de conversación interesante"],
            ["Topping de pizza horrible", "Topping de pizza delicioso"],
            ["Sonido molesto", "Sonido satisfactorio"],
            ["Ropa incómoda", "Ropa cómoda"],
            ["Olor horrible", "Olor agradable"],
            ["Clase aburrida", "Clase fascinante"],
            ["Regalo terrible", "Regalo considerado"],
            ["Hábito poco saludable", "Hábito saludable"],
            ["Quehacer aburrido", "Quehacer satisfactorio"],
            ["Canción olvidable", "Canción pegadiza"],
            ["Aplicación inútil", "Aplicación imprescindible"],
            ["Nombre de supervillano terrible", "Nombre de superhéroe increíble"],
            ["Sabor horrible", "Sabor delicioso"],
            ["Exposición aburrida", "Exposición asombrosa"],
            ["Nombre de banda terrible", "Nombre de banda genial"],
            ["Cita memorable de anuario mala", "Cita memorable de anuario genial"],
            ["Excusa mala", "Excusa creíble"],
            ["Mascota terrible", "Mascota adorable"],
            ["Invento malo", "Invento revolucionario"],
            ["Comercial molesto", "Comercial memorable"],
            ["Línea de recogida terrible", "Línea de recogida efectiva"],
            ["Relleno de sándwich horrible", "Relleno de sándwich delicioso"],
            ["Protector de pantalla aburrido", "Protector de pantalla hipnótico"],
            ["Hack de vida inútil", "Hack de vida genial"],
            ["Premisa de sitcom terrible", "Premisa de sitcom hilarante"],
            ["Canción de karaoke horrible", "Canción de karaoke divertida"],
            ["Tatuaje terrible", "Tatuaje significativo"],
            ["Pegatina de coche horrible", "Pegatina de coche ingeniosa"],
            ["Frase molesta", "Frase icónica"],
            ["Nombre de equipo terrible", "Nombre de equipo intimidante"],
            ["Comb. de sabores horrible", "Comb. de sabores deliciosa"],
            ["Curso universitario inútil", "Curso universitario transformador"],
            ["Tema de podcast terrible", "Tema de podcast emocionante"],
            ["Atracción de parque terrible", "Atracción de parque emocionante"],
            ["Truco de mascota molesto", "Truco de mascota impresionante"],
            ["Ejercicio terrible", "Ejercicio efectivo"],
            ["Juego de mesa horrible", "Juego de mesa adictivo"],
            ["Hábito molesto", "Hábito encantador"],
            ["Broma terrible", "Broma inofensiva"],
            ["Mascota de cereal horrible", "Mascota de cereal adorable"],
            ["Alarma molesta", "Alarma agradable"],
            ["Vacaciones horribles", "Vacaciones de ensueño"],
            ["Juguete horrible", "Juguete imprescindible"],
            ["Personaje de TV molesto", "Personaje de TV favorito"],
            ["Súperpoder con efecto secundario terrible", "Súperpoder genial"],
            ["Sabor de helado horrible", "Sabor de helado innovador"],
            ["Abreviación molesta", "Abreviación útil"],
            ["Idea de disfraz terrible", "Idea de disfraz creativa"],
            ["Error de cocina terrible", "Consejo de cocina genial"],
            ["Ejercicio molesto", "Ejercicio divertido"],
            ["Método de ruptura terrible", "Método de ruptura respetuoso"],
            ["Póster motivacional terrible", "Póster motivacional real"],
            ["Función de coche molesta", "Función de coche útil"],
            ["Escondite terrible", "Escondite ingenioso"],
            ["Tendencia terrible de tus padres", "Tendencia retro genial"],
            ["Comportamiento de turista molesto", "Comportamiento de turista respetuoso"],
            ["Hábito de compañero horrible", "Hábito ideal"],
            ["Motivo terrible para faltar al trabajo", "Motivo válido para faltar al trabajo"],
            ["Notificación de teléfono molesta", "Notificación importante"],
            ["Nombre de barco terrible", "Nombre de barco ingenioso"],
            ["Razón terrible para romper con alguien", "Razón válida para romper con alguien"],
            ["Comportamiento de gimnasio molesto", "Etiqueta correcta en gimnasio"],
            ["Aerolínea terrible", "Aerolínea de primera"],
            ["Grafiti de baño horrible", "Grafiti de baño profundo"],
            ["Casa de Hogwarts terrible", "Mejor casa de Hogwarts"],
            ["Razón horrible para tener una mascota", "Razón excelente para tener una mascota"],
            ["Asunto de correo molesto", "Asunto de correo llamativo"],
            ["Nombre de red WiFi terrible", "Nombre de red WiFi ingenioso"],
            ["Meme aburrido", "Meme hilarante"],
            ["Serie de TV mala", "Serie de TV increíble"],
            ["Snack horrible", "Snack delicioso"],
            ["Actividad aburrida", "Actividad emocionante"],
            ["Superpoder inútil", "Superpoder útil"],
            ["Comida muy picante", "Comida suave"],
            ["Tecnología obsoleta", "Tecnología moderna"]
        ];

        // Player setup functions
        playerCount.addEventListener('change', updatePlayerInputs);

        function updatePlayerInputs() {
            const count = parseInt(playerCount.value);
            playerNames.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const label = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = `Jugador ${i + 1}`;
                input.className = 'player-name-input border rounded p-2 mx-auto mb-3 block';
                label.appendChild(input);
                playerNames.appendChild(label);
            }
        }

        function updateScoreDisplay() {
            totalScoreElement.innerHTML = players.map((player, index) =>
                `<div class="${index === currentPlayerIndex ? 'current-player font-bold text-secondary' : ''}">
                    ${player.name}: ${player.score}
                </div>`
            ).join('');
        }

        initGameButton.addEventListener('click', () => {
            players = Array.from(playerNames.children).map(input => ({
                name: input.firstChild["value"] || input.firstChild["placeholder"],
                score: 0
            }));
            playerSetup.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            updateScoreDisplay();
            startGame();
        });

        // Initialize with 2 players
        updatePlayerInputs();

        // Game functions
        function setTargetArea() {
            targetAngle = Math.random() * 180 - 90;
            targetArea.style.background = `conic-gradient(
                from -90deg at 50% 100%,
                #eeefe8 0deg ${targetAngle - 22.5 + 90}deg,
                #fec942 ${targetAngle - 22.5 + 90}deg ${targetAngle - 13.5 + 90}deg,
                #ee7648 ${targetAngle - 13.5 + 90}deg ${targetAngle - 4.5 + 90}deg,
                #adc8da ${targetAngle - 4.5 + 90}deg ${targetAngle + 4.5 + 90}deg,
                #ee7648 ${targetAngle + 4.5 + 90}deg ${targetAngle + 13.5 + 90}deg,
                #fec942 ${targetAngle + 13.5 + 90}deg ${targetAngle + 22.5 + 90}deg,
                #eeefe8 ${targetAngle + 22.5 + 90}deg 180deg
            )`;
        }

        function setRandomClues() {
            const randomIndex = Math.floor(Math.random() * clues.length);
            const [left, right] = clues[randomIndex];
            console.log(left);
            document.getElementById("leftClue").textContent = left;
            document.getElementById("rightClue").textContent = right;
        }

        function calculateScore(angle) {
            const diff = Math.abs(angle - targetAngle);
            if (diff <= 4.5) {
                triggerConfetti();
                return 5;
            }
            if (diff <= 13.5) return 3;
            if (diff <= 22.5) return 1;
            return 0;
        }

        function handleStart(e) {
            if (!canMoveNeedle) return;
            isDragging = true;
            e.preventDefault();
        }

        function triggerConfetti() {
            confetti({
                particleCount: 150,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#ff0000', '#00ff00', '#0000ff'],
                ticks: 200,
                shapes: ['square'],
                gravity: 0.8,
                scalar: 1.2
            });
        }

        function handleMove(e) {
            if (!isDragging || !canMoveNeedle) return;
            e.preventDefault();
            const rect = needleContainer.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.bottom;

            let clientX, clientY;
            if (e.type === "touchmove") {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const angle = (Math.atan2(clientX - centerX, centerY - clientY) * 180) / Math.PI;
            const clampedAngle = Math.max(-90, Math.min(90, angle));
            needle.style.transform = `rotate(${clampedAngle}deg)`;
        }

        function handleEnd() {
            isDragging = false;
        }

        function hideNeedle() {
            needle.classList.add('hidden');
        }

        function showNeedle() {
            needle.classList.remove('hidden');
        }

        // Modal functionality
        howToPlayButton.onclick = function() {
            howToPlayModal.style.display = "block";
            setTimeout(() => howToPlayModal.classList.add("show"), 10);
        }

        closeButton.onclick = function() {
            howToPlayModal.classList.remove("show");
            setTimeout(() => howToPlayModal.style.display = "none", 300);
        }

        window.onclick = function(event) {
            if (event.target === howToPlayModal) {
                howToPlayModal.classList.remove("show");
                setTimeout(() => howToPlayModal.style.display = "none", 300);
            }
        }

        // Event listeners
        needleContainer.addEventListener("mousedown", handleStart);
        document.addEventListener("mousemove", handleMove);
        document.addEventListener("mouseup", handleEnd);

        needleContainer.addEventListener("touchstart", handleStart);
        document.addEventListener("touchmove", handleMove);
        document.addEventListener("touchend", handleEnd);

        toggleButton.addEventListener("click", () => {
            isTargetVisible = !isTargetVisible;
            targetArea.style.display = isTargetVisible ? "block" : "none";
            if (isTargetVisible) {
                let score, needleAngle;
                toggleButton.classList.add('hidden');

                nextRoundButton.textContent = "Siguiente";
                nextRoundButton.classList.add('bg-secondary', 'hover:bg-green-700');
                // nextRoundButton.classList.remove('hidden');

                needleAngle = parseFloat(needle.style.transform.replace("rotate(", "").replace("deg)", "")) || 0;
                score = calculateScore(needleAngle);
                players[currentPlayerIndex].score += score;

                scoreElement.textContent = `${players[currentPlayerIndex].name} ha obtenido ${score} puntos`;
                scoreElement.classList.remove("hidden");

                canMoveNeedle = false;
                updateScoreDisplay();
                if (score === 5) {
                    triggerConfetti();
                }
            } else {
                toggleButton.textContent = "Confirmar";
                toggleButton.classList.add('bg-secondary', 'hover:bg-green-700');

                showNeedle();
                canMoveNeedle = true;
            }
        });

        function newRound() {
            setTargetArea();
            setRandomClues();
            isTargetVisible = true;
            targetArea.style.display = "block";

            toggleButton.textContent = "Ocultar";
            toggleButton.classList.remove('hidden', 'bg-secondary', 'hover:bg-green-700');

            nextRoundButton.textContent = "Omitir";
            nextRoundButton.classList.remove('bg-secondary', 'hover:bg-green-700');
            // nextRoundButton.classList.add('hidden');

            needle.style.transform = "rotate(0deg)";
            scoreElement.textContent = "";

            scoreElement.classList.add("hidden");
            scoreElement.textContent = "";

            hideNeedle();
            updateScoreDisplay();
        }

        function startGame() {
            players.forEach(player => player.score = 0);
            currentPlayerIndex = 0;
            newRound();
        }

        nextRoundButton.addEventListener("click", () => {
            if (nextRoundButton.textContent === "Siguiente") {
                currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            }
            newRound();
        });

        newGameButton.addEventListener("click", startGame);

        // Initialize the game
        setTargetArea();
        setRandomClues();
        hideNeedle();
    </script>
</body>
</html>
